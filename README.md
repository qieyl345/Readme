<h1 align="center">ğŸ  RentVerse (Secured by Vecna)</h1>
<p align="center"><i>A Secure Property Rental Platform with DevSecOps Integration</i></p>

<div align="center">
  <img src="github/assets/LogoUiTM.png" width="550" height="550" alt="UiTM Logo"><br>
  <b>UiTM Tapah</b>
  <br><br>
  <hr width="50%">
  <br>
  <img src="github/assets/logo.png" width="250" height="250" alt="RentVerse Logo"><br>
  <i>Building the Future Through Innovation</i>
  <br><br>
  <hr width="50%">
  <br>
  <img src="github/assets/icon.jpg" width="350" height="350" alt="Team Vecna"><br>
  <b>Team Vecna</b>
</div>

---

## ğŸ“‹ Challenge Submission Details

| Field | Details |
|-------|---------|
| **Challenge** | Mobile SecOps 21 Days Challenge |
| **Organizer** | Metairflow R&D Sdn. Bhd. |
| **Team** | VECNA |
| **Institution** | UiTM Tapah |
| **Project Duration** | 27 November 2025 - 17 December 2025 |

---

## ğŸ‘¥ Team Vecna Members

<div align="center">
  <table>
    <tr>
      <td align="center" width="500">
        <img src="github/assets/bukh.jpg" width="400" height="400" alt="Bukhari"><br>
        <b>MOHAMAD BUKHARI BIN<br>AHMAD HUZAIRI</b><br>
        <code>2024916761</code><br>
        <sub>Backend & Cloud Infrastructure</sub>
      </td>
      <td align="center" width="500">
        <img src="github/assets/zul.jpg" width="400" height="400" alt="Zulkarnain"><br>
        <b>MUHAMAD ZULKARNAIN BIN<br>SAMSUDIN</b><br>
        <code>2024793133</code><br>
        <sub>Frontend & Beta Tester</sub>
      </td>
      <td align="center" width=500">
        <img src="github/assets/aqil.jpg" width="400" height="400" alt="Aqil"><br>
        <b>AQIL IMRAN BIN<br>NORHIDZAM</b><br>
        <code>2024779269</code><br>
        <sub>Security Lead</sub>
      </td>
    </tr>
  </table>
</div>

---

## ğŸ”— Quick Links

| Platform | Link |
|----------|------|
| ğŸŒ **Live Website** | [https://rentverse-frontend-nine.vercel.app/](https://rentverse-frontend-nine.vercel.app/) |
| ğŸ“± **Mobile App (APK)** | [Download RentVerse APK](MobileAppBuild/rentverse-vecna.apk) |
| ğŸ“š **API Docs** | [Swagger Documentation](/docs) |

### ğŸ§ª Test Admin Account

> **Note**: MFA is disabled only for this specific account to allow testing of admin functionalities. For non-MFA accounts, you won't be greeted by the Welcome Popup Modal.

| Credential | Value |
|------------|-------|
| ğŸ“§ **Email** | `admin@rentverse.com` |
| ğŸ”‘ **Password** | `password123` |

> **âš ï¸ Important**: To test **user** and **landlord** functionalities, you must register with your own **real email address**. Fake emails will not work on this system (both Web and Mobile App) as OTP verification is required.

---

## ğŸ“¸ Platform Preview

### Web Application
<!-- TODO: Add web-preview.png to github/assets/ -->
*Screenshot coming soon*

### Mobile Application
<!-- TODO: Add mobile-preview.png to github/assets/ -->
*Screenshot coming soon*

---

## ğŸ›¡ï¸ Security Compliance Matrix

| Requirement ID | Security Module | Implementation Status | OWASP Alignment |
| :--- | :--- | :---: | :--- |
| **SEC-01** | **Multi-Factor Authentication** | âœ… Implemented | M2: Insecure Authentication |
| **SEC-02** | **API Rate Limiting** | âœ… Implemented | M4: Insufficient Input/Output Validation |
| **SEC-03** | **Data Encryption (At Rest)** | âœ… Implemented | M5: Insecure Data Storage |
| **SEC-04** | **Data Encryption (In Transit)** | âœ… Implemented | M3: Insecure Communication |
| **SEC-05** | **Input Sanitization** | âœ… Implemented | M7: Client Code Quality |
| **SEC-06** | **Audit Logging** | âœ… Implemented | M1: Improper Platform Usage |

---

## ğŸ“‘ Table of Contents

| Section | Description |
|---------|-------------|
| [ğŸ‘¥ Team Members](#-team-members) | Meet Team Vecna |
| [ğŸ”— Quick Links](#-quick-links) | Live demo & download links |
| [ğŸ“¸ Platform Preview](#-platform-preview) | Web & Mobile screenshots |
| [ğŸ“ˆ System Flow Diagrams](#-system-flow-diagrams) | Architecture & flow visualizations |
| [ğŸ”§ Development Platforms](#-development-platforms) | Hosting & services used |
| **ğŸ›¡ï¸ Core Development Modules** | |
| [ğŸŸ¢ Module 1: Secure Login & MFA](#-module-1-secure-login--mfa-) | Authentication & Authorization |
| [ğŸ”µ Module 2: Secure API Gateway](#-module-2-secure-api-gateway-) | HTTPS, JWT, Rate Limiting |
| [ğŸŸ£ Module 3: Sensitive Data Handling](#-module-3-sensitive-data-handling-) | Encryption & Secure Storage |
| [ğŸŸ  Module 4: Secure Session Management](#-module-4-secure-session-management-) | Token Lifecycle & Blacklisting |
| [ğŸ©· Module 5: Input Validation & Defense](#-module-5-input-validation--defense-) | XSS, SQL Injection Prevention |
| [ğŸ”· Module 6: DevSecOps Integration](#-module-6-devsecops-integration-) | CI/CD Security Pipeline |
| **ğŸš€ Feature Innovation Pool** | |
| [ğŸŸ¡ Category 1: Threat Intelligence](#-category-1-threat-intelligence-system-ï¸) | Risk scoring & pattern detection |
| [ğŸŸª Category 2: Zero-Trust Access](#-category-2-zero-trust-access-logic-) | Device verification & session control |
| [ğŸŸ© Category 3: Adaptive Defense](#-category-3-adaptive-defense-dashboard-) | Security monitoring dashboard |
| [ğŸŸ« Category 4: Automated Testing](#-category-4-automated-security-testing-) | CI/CD security scanning |
| **âœ¨ Special Features** | |
| [ğŸ“ Digital Rental Agreements](#-digital-rental-agreements) | E-signatures & PDF generation |
| [ğŸ” OTP-Based Password Reset](#-otp-based-password-reset) | Secure password recovery |
| [ğŸ“§ Smart Email Notifications](#-smart-email-notification-system) | Responsive email templates |
| [ğŸ‘‘ Admin Dashboard](#-admin-dashboard) | Platform administration |
| [ğŸ“± Mobile Application](#-mobile-application) | Android app with Capacitor |
| [ğŸ“… Booking & Viewing System](#-booking--viewing-system) | Property scheduling |
| [ğŸ› ï¸ Technology Stack](#ï¸-technology-stack) | Backend, Frontend & DevOps tools |
| [ğŸ“š API Documentation](#-api-documentation) | Swagger UI endpoints |
| [âš–ï¸ IP & Legal](#-intellectual-property--ownership) | Ownership & Compliance |

---

## ğŸ“ˆ System Flow Diagrams

### ğŸ—ï¸ System Architecture Overview

```mermaid
flowchart TB
    subgraph Client["ğŸ‘¤ Client Layer"]
        WEB["ğŸŒ Web App<br/>Next.js 16"]
        MOBILE["ğŸ“± Mobile App<br/>Capacitor"]
    end

    subgraph Gateway["ğŸ” API Gateway"]
        AUTH["Authentication<br/>JWT + MFA"]
        RATE["Rate Limiting"]
        HELMET["Security Headers<br/>Helmet.js"]
    end

    subgraph Backend["âš™ï¸ Backend Services"]
        EXPRESS["Express.js API"]
        PRISMA["Prisma ORM"]
        SERVICES["Business Logic"]
    end

    subgraph External["â˜ï¸ External Services"]
        SUPABASE["Supabase<br/>PostgreSQL"]
        CLOUDINARY["Cloudinary<br/>Media CDN"]
        RESEND["Resend<br/>Email API"]
        GOOGLE["Google OAuth"]
        AI["RevAI<br/>Auto-Review"]
    end

    subgraph DevOps["ğŸ”„ DevSecOps"]
        GITHUB["GitHub Actions"]
        CODEQL["CodeQL + Trivy"]
        VERCEL["Vercel Deploy"]
        RENDER["Render Deploy"]
    end

    WEB --> Gateway
    MOBILE --> Gateway
    Gateway --> Backend
    Backend --> External
    GITHUB --> CODEQL
    GITHUB --> VERCEL
    GITHUB --> RENDER
```

### ğŸ” Authentication Flow (MFA/OTP)

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ User
    participant F as ğŸŒ Frontend
    participant A as ğŸ” Auth API
    participant D as ğŸ—„ï¸ Database
    participant E as ğŸ“§ Email Service

    U->>F: Enter email & password
    F->>A: POST /auth/login
    A->>D: Verify credentials
    
    alt Invalid Credentials
        A-->>F: 401 Unauthorized
        A->>D: Log failed attempt
        D-->>A: Check attempt count
        alt 5+ Failed Attempts
            A->>E: Send notification to admin
        end
    else Valid Credentials
        A->>D: Check MFA status
        alt MFA Enabled
            A->>A: Generate 6-digit OTP
            A->>D: Store hashed OTP
            A->>E: Send OTP email
            A-->>F: Require OTP verification
            U->>F: Enter OTP code
            F->>A: POST /auth/verify-otp
            A->>D: Verify OTP hash
            alt Valid OTP
                A->>D: Log successful login
                A->>D: Register device
                A-->>F: Return JWT token
            else Invalid OTP
                A-->>F: 401 Invalid OTP
            end
        else MFA Disabled
            A->>D: Log successful login
            A-->>F: Return JWT token
        end
    end
```

### ğŸ  Property Listing & Approval Flow

```mermaid
flowchart TD
    subgraph Landlord["ğŸ  Landlord Actions"]
        L1["Create Property Listing"]
        L2["Choose Property Type"]
        L3["Select Location Inide Map"]
        L4["Fill in Details Address"]
        L5["Enter Property Details"]
        L6["Upload Property Images"]
        L7["Input Property Name"]
        L8["Add Property Description"]
        L9["Submit & Save"]
    end

    subgraph System["âš™ï¸ System Processing"]
        S1{"Auto-Review<br/>Enabled?"}
        S2["RevAI Analysis"]
        S3["Flag for<br/>Manual Review"]
        S4["Create Pending<br/>Approval Record"]
    end

    subgraph Admin["ğŸ‘‘ Admin Review"]
        A1["View Pending Properties"]
        A2["Review Details"]
        A3{"Decision"}
        A4["âœ… Approve"]
        A5["âŒ Reject"]
    end

    subgraph Result["ğŸ“‹ Result"]
        R1["Property Live<br/>on Platform"]
        R2["Notify Landlord<br/>Approved"]
        R3["Notify Landlord<br/>Rejected"]
        R4["Property Hidden"]
    end

    L1 --> L2 --> L3 --> L4
    L4 --> S1
    S1 -->|Yes| S2
    S1 -->|No| S4
    S2 -->|Pass| A4
    S2 -->|Fail/Uncertain| S3
    S3 --> S4
    S4 --> A1
    A1 --> A2 --> A3
    A3 -->|Approve| A4
    A3 -->|Reject| A5
    A4 --> R1 --> R2
    A5 --> R4 --> R3
```

### ğŸ“ Digital Agreement Signing Flow

```mermaid
sequenceDiagram
    participant LL as ğŸ  Landlord
    participant T as ğŸ‘¤ Tenant
    participant API as âš™ï¸ Backend
    participant DB as ğŸ—„ï¸ Database
    participant PDF as ğŸ“„ PDF Service
    participant CDN as â˜ï¸ Cloudinary

    LL->>API: Create Lease Agreement
    API->>DB: Store lease terms
    API->>PDF: Generate PDF
    PDF->>CDN: Upload PDF
    API-->>LL: Agreement ready to sign

    LL->>API: Sign agreement (canvas signature)
    API->>API: Create SHA-256 signature hash
    API->>DB: Store landlord signature
    API->>DB: Update status: PENDING_TENANT
    API-->>T: Notify: Please sign agreement

    T->>API: View agreement
    API-->>T: Return PDF + details
    T->>API: Sign agreement (canvas signature)
    API->>API: Create SHA-256 signature hash
    API->>DB: Store tenant signature
    API->>DB: Update status: COMPLETED
    API->>PDF: Generate final signed PDF
    PDF->>CDN: Upload final PDF
    API-->>LL: Notify: Agreement completed
    API-->>T: Notify: Agreement completed
```

### ğŸ›¡ï¸ Security Monitoring Flow

```mermaid
flowchart LR
    subgraph Events["ğŸ“¥ Security Events"]
        E1["Login Attempt"]
        E2["Failed Login"]
        E3["New Device"]
        E4["Password Change"]
    end

    subgraph Analysis["ğŸ” Risk Analysis"]
        A1["Calculate Risk Score"]
        A2{"Risk >= 50?"}
        A3["Log Normal Activity"]
        A4["Flag High Risk"]
    end

    subgraph Response["âš¡ Auto Response"]
        R1["Create Security Alert"]
        R2["Send Email Notification"]
        R3["Lock Account<br/>if 5+ failures"]
    end

    subgraph Dashboard["ğŸ“Š Admin Dashboard"]
        D1["Real-time Statistics"]
        D2["Login History"]
        D3["Alert Management"]
        D4["User Investigation"]
    end

    E1 --> A1
    E2 --> A1
    E3 --> A1
    E4 --> R1
    A1 --> A2
    A2 -->|No| A3
    A2 -->|Yes| A4
    A4 --> R1
    R1 --> R2
    E2 --> R3
    A3 --> D1
    A4 --> D1
    R1 --> D3
    D1 --> D2
    D3 --> D4
```

### ğŸ”„ CI/CD Security Pipeline

```mermaid
flowchart LR
    subgraph Trigger["ğŸš€ Trigger"]
        T1["Push to Main"]
        T2["Pull Request"]
    end

    subgraph SAST["ğŸ”¬ SAST Checks"]
        S1["ESLint Analysis"]
        S2["TypeScript Check"]
        S3["npm Audit"]
    end

    subgraph Security["ğŸ” Security Scans"]
        SEC1["CodeQL Analysis"]
        SEC2["Gitleaks<br/>Secret Detection"]
        SEC3["Trivy<br/>Vulnerability Scan"]
    end

    subgraph Build["ğŸ—ï¸ Build"]
        B1["Backend Build"]
        B2["Frontend Build"]
    end

    subgraph Deploy["ğŸ“¦ Deploy"]
        D1["Vercel<br/>Frontend"]
        D2["Render<br/>Backend"]
    end

    T1 --> SAST
    T2 --> SAST
    SAST --> Security
    Security --> Build
    Build --> Deploy
```

---

## ğŸ”§ Development Platforms

<div align="center">
  <table>
    <tr>
      <td align="center" width="120">
        <img src="https://assets.vercel.com/image/upload/v1588805858/repositories/vercel/logo.png" width="48" height="48"><br>
        <b>Vercel</b><br>
        <sub>Frontend Hosting</sub>
      </td>
      <td align="center" width="120">
        <img src="https://images.g2crowd.com/uploads/product/image/large_detail/large_detail_477db83f729d63210139ec7cd29c1351/render-render.png" width="48" height="48"><br>
        <b>Render</b><br>
        <sub>Backend Hosting</sub>
      </td>
      <td align="center" width="120">
        <img src="https://www.vectorlogo.zone/logos/supabase/supabase-icon.svg" width="48" height="48"><br>
        <b>Supabase</b><br>
        <sub>PostgreSQL Database</sub>
      </td>
      <td align="center" width="120">
        <img src="https://cdn.simpleicons.org/resend" width="48" height="48"><br>
        <b>Resend</b><br>
        <sub>Email Service</sub>
      </td>
    </tr>
    <tr>
      <td align="center" width="120">
        <img src="https://user-images.githubusercontent.com/236501/85893648-1c92e880-b7a8-11ea-926d-95355b8175c7.png" width="48" height="48"><br>
        <b>Capacitor</b><br>
        <sub>Mobile App</sub>
      </td>
      <td align="center" width="120">
        <img src="https://www.vectorlogo.zone/logos/google/google-icon.svg" width="48" height="48"><br>
        <b>Google OAuth</b><br>
        <sub>Authentication</sub>
      </td>
      <td align="center" width="120">
        <img src="https://avatars.githubusercontent.com/u/1460763" width="48" height="48"><br>
        <b>Cloudinary</b><br>
        <sub>Media Storage</sub>
      </td>
      <td align="center" width="120">
        <img src="https://cdn.simpleicons.org/maptiler" width="48" height="48"><br>
        <b>MapTiler</b><br>
        <sub>Maps & Geocoding</sub>
      </td>
    </tr>
    <tr>
      <td align="center" width="120">
        <img src="https://www.vectorlogo.zone/logos/github/github-icon.svg" width="48" height="48"><br>
        <b>GitHub Actions</b><br>
        <sub>CI/CD Pipeline</sub>
      </td>
      <td align="center" width="120">
        <img src="https://avatars.githubusercontent.com/u/17219288" width="48" height="48"><br>
        <b>Prisma</b><br>
        <sub>ORM</sub>
      </td>
      <td align="center" width="120">
        <img src="https://www.vectorlogo.zone/logos/nodejs/nodejs-icon.svg" width="48" height="48"><br>
        <b>Node.js</b><br>
        <sub>Runtime</sub>
      </td>
      <td align="center" width="120">
        <img src="https://www.vectorlogo.zone/logos/nextjs/nextjs-icon.svg" width="48" height="48"><br>
        <b>Next.js</b><br>
        <sub>React Framework</sub>
      </td>
    </tr>
  </table>
</div>

---

## ğŸ›¡ï¸ Core Development Modules (Module 1-6)

> **Technical Documentation** - All security modules implemented based on actual codebase analysis.

### ğŸŸ¢ Module 1: Secure Login & MFA ğŸ”

**Description:** Role-based MFA/OTP login with device verification and suspicious activity detection.  
**Security Focus:** Authentication & Authorization (OWASP M1â€“M3)  
**Key Files:** `src/services/enhancedMFA.service.js`, `src/services/fastOTPService.js`

#### Role-Based MFA Policies

| Role | MFA Required | Session Timeout | Max Failed Attempts | Login Hours | Device Verification |
|------|--------------|-----------------|---------------------|-------------|---------------------|
| **ADMIN** | âœ… Yes | 15 min | 3 attempts | 6 AM - 10 PM | âœ… Required |
| **LANDLORD** | âœ… Yes | 30 min | 5 attempts | 5 AM - 11 PM | âœ… Required |
| **USER** | âŒ Optional | 60 min | 5 attempts | 24/7 | âŒ Optional |

```javascript
// Role-Based MFA Policy Configuration (enhancedMFA.service.js)
roleBasedMFAPolicies = {
  ADMIN: {
    requireMFA: true,
    allowedMethods: ['TOTP', 'SMS', 'EMAIL'],
    sessionTimeout: 15, // minutes
    maxFailedAttempts: 3,
    allowedLoginHours: { start: 6, end: 22 },
    requireDeviceVerification: true
  },
  LANDLORD: {
    requireMFA: true,
    allowedMethods: ['TOTP', 'EMAIL'],
    sessionTimeout: 30,
    maxFailedAttempts: 5,
    requireDeviceVerification: true
  },
  USER: {
    requireMFA: false,
    sessionTimeout: 60,
    requireDeviceVerification: false
  }
};
```

#### Multi-Factor Authentication Features

| Feature | Implementation |
|---------|----------------|
| **OTP Generation** | Speakeasy TOTP with 5-minute step window |
| **OTP Delivery** | Parallel email + SMS delivery via `fastOTPService.js` |
| **TOTP Authenticator** | QR code generation for Google Authenticator |
| **Backup Codes** | 10 recovery codes generated on MFA setup |
| **Expiry** | Role-based (15-60 minutes based on user role) |

#### Fast OTP Service (`fastOTPService.js`)

```javascript
// High-performance OTP with parallel delivery
async sendOTP(email, otp, options = {}) {
  const deliveryPromises = [];
  
  // Email delivery (primary)
  deliveryPromises.push(this.sendOTPEmail(email, otp, deliveryId));

  // SMS delivery (backup, if configured)
  if (this.smsProvider && options.sendSMS) {
    deliveryPromises.push(this.sendOTPSMS(phoneNumber, otp, deliveryId));
  }

  // Wait for all delivery methods in parallel
  const deliveryResults = await Promise.all(deliveryPromises);
  return { success: deliveryResults.filter(r => r.success).length > 0 };
}
```

#### Suspicious Activity Detection

```javascript
// Risk score calculation for login attempts
async detectSuspiciousActivity(user) {
  let riskScore = 0;
  let reasons = [];

  // Failed attempts check (+0.3)
  if (user.loginAttempts > 0) {
    riskScore += 0.3;
    reasons.push('Previous failed attempts');
  }

  // Rapid successive logins (+0.2)
  const hoursSinceLastLogin = (Date.now() - user.lastLoginAt) / (1000 * 60 * 60);
  if (hoursSinceLastLogin < 1) {
    riskScore += 0.2;
    reasons.push('Rapid successive login attempts');
  }

  // Outside normal hours (+0.4)
  if (currentHour < policy.allowedLoginHours.start) {
    riskScore += 0.4;
    reasons.push('Login outside normal hours');
  }

  // Block if risk score > 0.8
  return { riskScore, blocked: riskScore > 0.8, reasons };
}
```

| Risk Factor | Points Added | Description |
|-------------|--------------|-------------|
| Previous Failed Attempts | +0.3 | User has failed login attempts |
| Rapid Logins | +0.2 | Login within 1 hour of last attempt |
| Outside Normal Hours | +0.4 | Login outside configured hours |
| **Block Threshold** | **> 0.8** | User login blocked |

#### Account Lockout

| Feature | Value |
|---------|-------|
| Max Attempts | Role-based (3 for ADMIN, 5 for others) |
| Lockout Duration | 15 minutes |
| Notification | Security alert email sent |


##### ğŸ”„ MFA Toggle (User-Controlled)
- **Enable MFA:** One-click enable from Security Settings
- **Disable MFA:** Requires password confirmation for security
- **Real-time Status:** Visual indicator shows current MFA status
- **Email Notification:** Users receive email when MFA status changes

**Key Files:**
- `app/account/security/page.tsx` - MFA toggle UI component
- `auth.js` - `/mfa/enable` and `/mfa/disable` endpoints

---

### ğŸ”µ Module 2: Secure API Gateway ğŸ”’

**Description:** Multi-tier rate limiting, security headers, and request validation.  
**Security Focus:** Secure Communication (OWASP M5â€“M6)  
**Key Files:** `src/middleware/rateLimiter.js`, `src/middleware/security.js`

#### Multi-Tier Rate Limiting (`rateLimiter.js`)

| Limiter Type | Limit | Window | Purpose |
|--------------|-------|--------|---------|
| **General** | 100 requests | 15 min | Standard API protection |
| **Login** | 5 attempts | 15 min | Brute force prevention |
| **Register** | 3 attempts | 1 hour | Registration abuse |
| **OTP** | 3 requests | 10 min | OTP flooding prevention |
| **Admin** | 50 requests | 15 min | Admin endpoint protection |
| **Upload** | 10 uploads | 1 hour | File upload control |
| **Search** | 200 requests | 15 min | Search abuse prevention |
| **Password Reset** | 3 requests | 1 hour | Reset abuse prevention |

```javascript
// Rate Limiter Configuration (rateLimiter.js)
const rateLimiters = {
  general: createRateLimiter({ windowMs: 15 * 60 * 1000, max: 100 }),
  login: createRateLimiter({ windowMs: 15 * 60 * 1000, max: 5, skipSuccessfulRequests: true }),
  otp: createRateLimiter({ windowMs: 10 * 60 * 1000, max: 3 }),
  admin: createRateLimiter({ windowMs: 15 * 60 * 1000, max: 50 }),
  upload: createRateLimiter({ windowMs: 60 * 60 * 1000, max: 10 }),
  passwordReset: createRateLimiter({ windowMs: 60 * 60 * 1000, max: 3 })
};
```

#### Security Middleware Stack (`security.js`)

| Middleware | Purpose |
|------------|---------|
| **Helmet.js** | Security headers (XSS, CSP, HSTS, frame protection) |
| **HTTPS Enforcement** | Redirect HTTP to HTTPS for secure paths |
| **XSS Protection** | Null byte removal from request bodies |
| **SQL Injection Detection** | Pattern-based detection with logging |
| **CORS Config** | Allowlist-based origin validation |
| **Request Size Limit** | 10MB maximum request size |

```javascript
// Content Security Policy (security.js)
const securityHeaders = helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'", "'unsafe-inline'", "https://cdn.jsdelivr.net"],
      styleSrc: ["'self'", "'unsafe-inline'", "https://fonts.googleapis.com"],
      imgSrc: ["'self'", "data:", "https:", "blob:"],
      connectSrc: ["'self'", "https:", "wss:"],
      frameSrc: ["'none'"],
      objectSrc: ["'none'"]
    }
  }
});

// SQL Injection Detection
const sqlInjectionProtection = (req, res, next) => {
  const dangerousPatterns = [
    /(\%27)|(\')|(--)|(\%23)|(#)/gi,
    /\w*((\%27)|(\'))union[^\w]*((\%27)|(\'))/gi
  ];
  
  if (checkForSQL(req.body)) {
    console.log(`ğŸš¨ SQL Injection attempt from IP: ${req.ip}`);
    return res.status(400).json({ message: 'Invalid request format' });
  }
  next();
};
```

#### CORS Configuration

```javascript
const corsOptions = {
  origin: ['http://localhost:3000', 'http://localhost:3001', 
           'https://rentverse-frontend.vercel.app'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'X-CSRF-Token', 'X-API-Key'],
  exposedHeaders: ['X-RateLimit-Limit', 'X-RateLimit-Remaining', 'X-RateLimit-Reset'],
  maxAge: 86400 // 24 hours
};
```

---

### ğŸŸ£ Module 3: Digital Agreement ğŸ“

**Description:** JWT-based digital signatures with replay attack prevention and document integrity verification.  
**Security Focus:** Data Integrity & Workflow Validation  
**Key Files:** `src/services/digitalSignatureValidation.js`, `src/services/pdfGeneration.service.js`

#### Digital Signature System (`digitalSignatureValidation.js`)

| Feature | Implementation |
|---------|----------------|
| **JWT Signatures** | Cryptographic signing with 24-hour expiry |
| **Nonce Generation** | 16-byte random nonce prevents replay attacks |
| **Document Hash** | SHA-256 with secret salt for integrity |
| **Permission Check** | Validates user access (owner, tenant, or signer) |

```javascript
// Generate Signature Payload (digitalSignatureValidation.js)
generateSignaturePayload(documentId, userId, userRole, documentHash) {
  const timestamp = Date.now();
  const nonce = crypto.randomBytes(16).toString('hex');
  
  const payload = {
    documentId, userId, userRole, documentHash,
    timestamp, nonce, version: '1.0'
  };

  // Create JWT signature for tamper-proof verification
  const signature = jwt.sign(payload, process.env.JWT_SECRET, {
    expiresIn: '24h',
    issuer: 'rentverse-dsa'
  });

  return { payload, signature, expiresAt: new Date(timestamp + 24*60*60*1000) };
}
```

#### Replay Attack Prevention

```javascript
// Validate signature and prevent reuse (digitalSignatureValidation.js)
async validateSignature(signature, documentId, userId) {
  const decoded = jwt.verify(signature, process.env.JWT_SECRET);

  // Check for existing signature with same nonce (replay attack)
  const existingSignature = await prisma.digitalSignature.findFirst({
    where: {
      documentId, userId,
      nonce: decoded.nonce,
      createdAt: { gte: new Date(Date.now() - 10 * 60 * 1000) } // Last 10 min
    }
  });

  if (existingSignature) {
    throw new Error('Signature already used - potential replay attack');
  }

  return { valid: true, user: decoded.userId, timestamp: decoded.timestamp };
}
```

#### PDF Generation with Document Hashing (`pdfGeneration.service.js`)

```javascript
// Generate and sign rental agreement PDF
async generateAndUploadRentalAgreementPDF(leaseId) {
  // 1. Get lease data with property, tenant, landlord info
  const lease = await prisma.lease.findUnique({ where: { id: leaseId }, include: {...} });

  // 2. Render HTML template with EJS
  const html = ejs.render(templateContent, templateData);

  // 3. Generate PDF with Puppeteer
  const browser = await puppeteer.launch({ headless: true, args: ['--no-sandbox'] });
  const pdfBuffer = await page.pdf({ format: 'A4', printBackground: true });

  // 4. ï¿½ Create SHA-256 document hash for digital signature
  const digitalSignature = generateDocumentHash(pdfBuffer);
  console.log(`âœ… Document Secured. SHA-256 Hash: ${digitalSignature}`);

  // 5. Save to database with signature
  await prisma.rentalAgreement.create({
    data: {
      leaseId, pdfUrl, fileName, fileSize,
      digitalSignature,  // SHA-256 hash
      signedAt: new Date()
    }
  });
}
```

#### Signature Audit Trail

| Field | Description |
|-------|-------------|
| `signatureHash` | SHA-256 hash of the JWT signature |
| `nonce` | Unique random value for replay prevention |
| `ipAddress` | Signer's IP address |
| `userAgent` | Signer's browser/device info |
| `status` | PENDING, SIGNED, REJECTED |
| `metadata` | Role, timestamp, version info |

---

### ğŸŸ  Module 4: Smart Notification & Alert System ğŸ””

**Description:** AI-powered security anomaly detection with automated alert system.  
**Security Focus:** DevSecOps Monitoring & Incident Detection  
**Key Files:** `src/services/securityAnomalyDetection.js`, `src/services/enhancedEmailService.js`

#### Security Anomaly Detection (`securityAnomalyDetection.js`)

| Anomaly Type | Severity | Trigger | Auto-Alert |
|--------------|----------|---------|------------|
| `FAILED_LOGIN` | HIGH | 5+ failed OTP attempts in 15 min | âœ… Yes |
| `MULTIPLE_FAILED_LOGINS` | HIGH | 3+ failed logins in 15 min | âœ… Yes |
| `UNUSUAL_ACCESS_TIME` | MEDIUM | Login outside 11 PM - 6 AM | âŒ Log only |
| `MULTIPLE_SESSIONS` | MEDIUM | Multiple logins within 5 min | âŒ Log only |
| `API_ABUSE` | HIGH | Rate limit breaches | âœ… Yes |
| `BRUTE_FORCE` | CRITICAL | Sustained attack pattern | âœ… Yes |

#### Anomaly Thresholds Configuration

```javascript
// Security Anomaly Thresholds (securityAnomalyDetection.js)
anomalyThresholds = {
  failedLogins: 3,           // Failed logins before flagging
  failedOTPs: 5,             // Failed OTP attempts before flagging
  unusualHours: { start: 23, end: 6 },  // 11 PM - 6 AM
  locationChangeThreshold: 100,  // KM difference for location change
  apiRateLimitBreaches: 5,   // Rate limit hits
  sessionDuration: { min: 300, max: 28800 }  // 5 min to 8 hours
};
```

#### AI-Powered Pattern Analysis

```javascript
// AI Service Integration for Anomaly Detection
async analyzeWithAI(userData) {
  const response = await axios.post(`${this.aiServiceUrl}/api/v1/anomaly/detect`, {
    user_id: userData.userId,
    user_email: userData.userEmail,
    user_role: userData.userRole,
    ip_address: userData.ipAddress,
    user_agent: userData.userAgent,
    login_success: userData.success,
    recent_activity: userData.recentActivity,  // Last 24 hours
    analysis_type: 'security'
  });
  return response.data;
}
```

#### Anomaly Recording & Resolution

```javascript
// Record anomalies to database
await prisma.securityAnomaly.createMany({
  data: anomalies.map(anomaly => ({
    userId, type: anomaly.type,
    severity: anomaly.severity,
    description: anomaly.description,
    ipAddress, userAgent,
    metadata: anomaly.metadata,
    resolved: false  // Requires admin resolution
  }))
});

// Admin can resolve anomalies
await prisma.securityAnomaly.update({
  where: { id: anomalyId },
  data: { resolved: true, resolvedAt: new Date() }
});
```

#### High Severity Alert Workflow

```mermaid
flowchart LR
    A[Anomaly Detected] --> B{Severity?}
    B -->|HIGH/CRITICAL| C[Log to Console]
    C --> D[Record in Database]
    D --> E[Send Security Alert Email]
    B -->|MEDIUM/LOW| F[Log Only]
    F --> D
```

---

### ğŸ”´ Module 5: Activity Log Dashboard ğŸ“Š

**Description:** Provide admin-level logs for failed logins and critical actions.  
**Security Focus:** Threat Visualization & Accountability

#### Implementation Details

##### ğŸ“ˆ Dashboard Statistics

| Metric | Description |
|--------|-------------|
| 24h Login Metrics | Total, successful, failed logins |
| OAuth vs Email | Breakdown of login methods |
| High Risk Logins | Logins with risk score â‰¥50 |
| Locked Accounts | Currently locked user accounts |
| 7-Day Trends | Daily login success/failure charts |

**Key Files:** `src/routes/admin.security.routes.js` - Admin security API endpoints

```javascript
// Statistics Endpoint
GET /api/admin/security/statistics
Response: {
    totalLogins24h, failedLogins24h, successfulLogins24h,
    highRiskLogins24h, alertsSent24h, newDevices24h,
    oauthLogins24h, emailLogins24h, lockedAccounts,
    failureRate, trends: { daily: [...] }
}
```

##### ğŸ“‹ Login History
- **Paginated View:** Browse all login attempts
- **Filters:** By success/failure, high risk, user
- **Details:** IP address, device type, browser, OS, risk score

##### ğŸ” User Investigation
- **Per-User History:** View specific user's login activity
- **Device Management:** See registered devices per user
- **Alert History:** User's security alerts

---

### ğŸ”· Module 6: CI/CD Security Testing (Bonus) âš™ï¸

**Description:** Automated security scanning pipeline with multi-tool analysis.  
**Security Focus:** Continuous Testing (DevSecOps)  
**Workflow File:** `.github/workflows/security-scan.yml`

#### Security Scanning Pipeline

```yaml
# .github/workflows/security-scan.yml
name: ğŸ›¡ï¸ Security Testing (SAST) - Module 6

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“ Checkout code
      - name: ğŸ”§ Setup Node.js 18
      - name: ğŸ”§ Setup Python 3.9
      - name: ğŸ“¦ Install dependencies (npm ci + pip)
      - name: ğŸ” Run Bandit (Python SAST)
      - name: ğŸ” Run Semgrep (JavaScript/TypeScript SAST)
      - name: ğŸ” Run CodeQL Analysis
      - name: ğŸš« Dependency Security Audit (npm audit + Safety)
      - name: ğŸ”‘ Secret Detection (TruffleHog)
      - name: ğŸ“Š Upload Security Reports
      - name: âœ… Security Gate Check
```

#### Security Tools Matrix

| Tool | Purpose | Language | Report |
|------|---------|----------|--------|
| **Bandit** | Python SAST security linter | Python | JSON/TXT |
| **Semgrep** | Multi-language SAST scanner | JS/TS | SARIF |
| **CodeQL** | Semantic code analysis | JS/Python | SARIF |
| **npm audit** | Node.js dependency vulnerabilities | Node.js | Console |
| **Safety** | Python package vulnerabilities | Python | JSON |
| **TruffleHog** | Secret/credential detection | All | Console |

#### Semgrep Rule Sets

```yaml
# Configured rule sets for comprehensive coverage
config: >-
  p/security-audit
  p/secrets
  p/owasp-top-ten
  p/javascript
  p/typescript
```

#### Security Gate Summary

```bash
# Generated in GITHUB_STEP_SUMMARY
## ğŸ›¡ï¸ Security Scan Results

### âœ… Completed Security Checks:
- Bandit (Python SAST)
- Semgrep (JavaScript/TypeScript SAST)
- CodeQL (Semantic Analysis)
- Dependency Audit (npm audit)
- Safety Check (Python packages)
- Secret Detection

### ğŸ¯ Module 6 Status: **COMPLETE**

**All 6 Security Modules Now Implemented:**
1. âœ… Secure Login & MFA
2. âœ… Secure API Gateway
3. âœ… Digital Agreement (Mobile)
4. âœ… Smart Notification & Alert System
5. âœ… Activity Log Dashboard
6. âœ… **CI/CD Security Testing** â† **IMPLEMENTED**
```

---

## ğŸš€ Feature Innovation Pool (Category 1-4)

*Additional advanced security features implemented beyond core modules.*

### ğŸŸ¡ Category 1: Threat Intelligence System ğŸ›¡ï¸

**Description:** A rule-based module that detects unusual access patterns, repeated failed logins, and potential intrusion attempts through intelligent pattern analysis.

#### Flow Diagram

```mermaid
flowchart TD
    subgraph Input["ğŸ“¥ Login Event"]
        A["User Login Attempt"]
    end

    subgraph Analysis["ğŸ” Threat Analysis"]
        B["Extract User Agent & IP"]
        C["Generate Device Hash"]
        D{"Known Device?"}
        E["Check IP Failure History"]
        F{"5+ Failures?"}
        G["Check Login Time"]
        H{"2-5 AM?"}
    end

    subgraph Scoring["ğŸ“Š Risk Scoring"]
        S1["+0 Points"]
        S2["+30 Points<br/>New Device"]
        S3["+25 Points<br/>Suspicious IP"]
        S4["+15 Points<br/>Unusual Time"]
        S5["Calculate Total<br/>Risk Score"]
    end

    subgraph Response["âš¡ Response"]
        R1{"Score >= 50?"}
        R2["âœ… Normal Login"]
        R3["âš ï¸ High Risk Alert"]
        R4["ğŸ“§ Send Email Alert"]
        R5["ğŸ“ Log to Dashboard"]
    end

    A --> B --> C --> D
    D -->|Yes| S1
    D -->|No| S2
    S1 --> E
    S2 --> E
    E --> F
    F -->|No| G
    F -->|Yes| S3
    S3 --> G
    G --> H
    H -->|No| S5
    H -->|Yes| S4
    S4 --> S5
    S5 --> R1
    R1 -->|No| R2
    R1 -->|Yes| R3
    R3 --> R4
```

#### Implementation Details

**Risk Score Calculation** (`suspiciousActivity.service.js`):

```javascript
// Dynamic risk scoring based on multiple factors
async function calculateRiskScore(userId, ipAddress, userAgent) {
    let riskScore = 0;
    
    // New device detection (+30 points)
    const deviceHash = generateDeviceHash(userAgent, ipAddress);
    const knownDevice = await prisma.userDevice.findFirst({
        where: { userId, deviceHash },
    });
    if (!knownDevice) riskScore += 30;
    
    // IP failure history (+25 points if >5 failures)
    const ipFailures = await prisma.loginHistory.count({
        where: {
            ipAddress,
            success: false,
            createdAt: { gte: new Date(Date.now() - 60 * 60 * 1000) },
        },
    });
    if (ipFailures > 5) riskScore += 25;
    
    return Math.min(riskScore, 100);
}
```

**Suspicious Pattern Detection:**

| Pattern Type | Detection Criteria | Severity |
|--------------|-------------------|----------|
| Multiple Failures | 3+ failures in 5 minutes | High |
| Geographic Anomaly | Logins from 3+ IPs in 1 hour | Medium |
| Unusual Timing | Logins between 2-5 AM | Low |
| Brute Force | 5 failed attempts â†’ account lock | Critical |

**Key Files:**
- `suspiciousActivity.service.js` - Pattern detection & risk scoring
- `otp.service.js` - Failed attempt tracking & account lockout
- `apiLogger.js` - Security event logging

---

### ğŸŸª Category 2: Zero-Trust Access Logic ğŸ”

**Description:** Implements conditional access controls including device verification, automatic token invalidation, and comprehensive session management.

#### Flow Diagram

```mermaid
flowchart LR
    subgraph Request["ğŸ“¥ API Request"]
        A["Incoming Request"]
        B["Extract JWT Token"]
    end

    subgraph Validation["ğŸ” Zero-Trust Validation"]
        C{"Token Present?"}
        D{"Token Blacklisted?"}
        E{"Token Expired?"}
        F["Decode JWT Payload"]
        G{"User Active?"}
    end

    subgraph Device["ğŸ“± Device Check"]
        H["Generate Device Hash"]
        I{"Known Device?"}
        J["Register New Device"]
        K["Send Device Alert"]
    end

    subgraph Result["âœ… Result"]
        R1["âŒ 401 Unauthorized"]
        R2["âŒ 403 Token Revoked"]
        R3["âŒ 401 Token Expired"]
        R4["âŒ 403 Account Disabled"]
        R5["âœ… Access Granted"]
    end

    A --> B --> C
    C -->|No| R1
    C -->|Yes| D
    D -->|Yes| R2
    D -->|No| E
    E -->|Yes| R3
    E -->|No| F --> G
    G -->|No| R4
    G -->|Yes| H --> I
    I -->|Yes| R5
    I -->|No| J --> K --> R5
```

#### Implementation Details

**Device Fingerprinting & Tracking** (`suspiciousActivity.service.js`):

```javascript
// Generate unique device hash from user agent + IP
function generateDeviceHash(userAgent, ipAddress) {
    const data = `${userAgent || 'unknown'}-${ipAddress || 'unknown'}`;
    return crypto.createHash('sha256').update(data).digest('hex').substring(0, 32);
}

// Register and track devices per user
async function checkDevice(userId, userAgent, ipAddress) {
    const deviceHash = generateDeviceHash(userAgent, ipAddress);
    
    const existingDevice = await prisma.userDevice.findFirst({
        where: { userId, deviceHash },
    });
    
    if (!existingDevice) {
        // Alert user about new device login
        return { isNew: true, device: await registerNewDevice() };
    }
    return { isNew: false, device: existingDevice };
}
```

**Token Blacklist System** (`tokenBlacklist.js`):
- Immediate token invalidation on logout
- Automatic cleanup of expired tokens every hour
- User-wide token revocation capability
- Statistics tracking for security monitoring

**Zero-Trust Features:**

| Feature | Implementation | OWASP Alignment |
|---------|---------------|-----------------|
| New Device Alerts | Email + Security Alert | M1, M3 |
| Token Blacklisting | In-memory with cleanup | M6 |
| Session Validation | JWT expiry + blacklist check | M1 |
| User-Agent Tracking | SHA-256 fingerprinting | M3 |

---

### ğŸŸ© Category 3: Adaptive Defense Dashboard ğŸ’»

**Description:** An interactive admin dashboard that visualizes system risk levels and auto-responds to flagged security events with automated countermeasures.

#### Flow Diagram

```mermaid
flowchart TD
    subgraph DataSources["ğŸ“Š Data Sources"]
        D1["Login History"]
        D2["Security Alerts"]
        D3["User Devices"]
        D4["Failed Attempts"]
    end

    subgraph Processing["âš™ï¸ Real-time Processing"]
        P1["Aggregate 24h Stats"]
        P2["Calculate Failure Rate"]
        P3["Identify High-Risk Users"]
        P4["Generate 7-Day Trends"]
    end

    subgraph Dashboard["ğŸ“ˆ Admin Dashboard"]
        V1["Statistics Cards"]
        V2["Login History Table"]
        V3["Alert Feed"]
        V4["Trend Charts"]
        V5["At-Risk Users List"]
    end

    subgraph Actions["âš¡ Admin Actions"]
        A1["Unlock Account"]
        A2["Investigate User"]
        A3["Export Report"]
        A4["View Device History"]
    end

    D1 --> P1
    D2 --> P1
    D3 --> P1
    D4 --> P1
    P1 --> P2
    P1 --> P3
    P1 --> P4
    P2 --> V1
    P3 --> V5
    P4 --> V4
    D1 --> V2
    D2 --> V3
    V5 --> A2
    V2 --> A1
    V3 --> A4
    V1 --> A3
```

#### Implementation Details

**Security Statistics API** (`admin.security.routes.js`):

```javascript
// Real-time security metrics
const statistics = {
    totalLogins24h,
    failedLogins24h,
    successfulLogins24h,
    highRiskLogins24h,      // Risk score >= 50
    alertsSent24h,
    newDevices24h,
    uniqueUsers24h,
    lockedAccounts,         // Currently locked
    oauthLogins24h,         // Google, Facebook, etc.
    emailLogins24h,
    failureRate: Math.round((failedLogins24h / totalLogins24h) * 100),
};
```

**Auto-Response Mechanisms:**

| Trigger | Automatic Response | Notification |
|---------|-------------------|--------------|
| 5 Failed Logins | Account locked 15 min | Email + Alert |
| High Risk Login | Security alert created | Email |
| New Device | Device registered + alert | Email |
| Multiple IPs | Suspicious activity flag | Dashboard |

**Users at Risk Tracking:**

```javascript
// Identify high-risk users automatically
const usersWithHighRisk = await prisma.loginHistory.groupBy({
    by: ['userId'],
    where: {
        createdAt: { gte: last24h },
        riskScore: { gte: 50 },
    },
    _count: true,
});
```

**Dashboard Features:**
- 7-day login trend visualization
- Alert type distribution charts
- Top 20 at-risk users list
- User investigation with full history
- One-click account unlock capability

---

### ğŸŸ« Category 4: Automated Security Testing ğŸ§ª

**Description:** Integrated security scanning tools in the CI/CD pipeline that run automatically before each deployment to catch vulnerabilities early.

#### Flow Diagram

```mermaid
flowchart LR
    subgraph Trigger["ğŸš€ Trigger"]
        T1["Git Push"]
        T2["Pull Request"]
        T3["Schedule"]
    end

    subgraph SAST["ğŸ”¬ SAST"]
        S1["ESLint"]
        S2["TypeScript"]
        S3["npm Audit"]
    end

    subgraph Security["ğŸ” Security"]
        SEC1["CodeQL"]
        SEC2["Gitleaks"]
        SEC3["Trivy"]
    end

    subgraph Gates["ğŸš¦ Quality Gates"]
        G1{"Critical Issues?"}
        G2{"Secrets Found?"}
        G3{"High CVEs?"}
    end

    subgraph Result["ğŸ“‹ Result"]
        R1["âŒ Build Failed"]
        R2["âœ… Build Passed"]
        R3["ğŸ“Š Generate Report"]
        R4["ğŸš€ Deploy"]
    end

    T1 --> SAST
    T2 --> SAST
    T3 --> Security
    SAST --> Security
    S1 --> G1
    SEC2 --> G2
    SEC3 --> G3
    G1 -->|Yes| R1
    G2 -->|Yes| R1
    G3 -->|Yes| R1
    G1 -->|No| G2
    G2 -->|No| G3
    G3 -->|No| R2
    R2 --> R3
    R3 --> R4
```

#### Implementation Details

**GitHub Actions Security Workflow** (`.github/workflows/security-scan.yml`):

| Tool | Purpose | Integration |
|------|---------|-------------|
| ESLint | Static code analysis | Every PR/push |
| TypeScript | Type safety verification | Every PR/push |
| npm audit | Dependency vulnerabilities | Every PR/push |
| CodeQL | Advanced security analysis | Every PR/push |
| Gitleaks | Secret detection | Every PR/push |
| Trivy | Container/dependency scan | Every PR/push |

**Pipeline Configuration:**

```yaml
# Security scanning on every push
jobs:
  backend-sast:
    - npm audit --audit-level=moderate
    - npx eslint src/ --max-warnings 0
    
  secret-detection:
    - gitleaks detect --source . --verbose
    
  dependency-scan:
    - trivy fs . --severity HIGH,CRITICAL
    
  codeql-analysis:
    - github/codeql-action/analyze
```

**Security Gates:**
- âŒ Build fails on HIGH/CRITICAL vulnerabilities
- âŒ Build fails on detected secrets
- âŒ Build fails on critical ESLint errors
- âœ… Security report generated for each run

**Current Pipeline Status:**

| Check | Status |
|-------|--------|
| Backend SAST | âœ… Active |
| Frontend SAST | âœ… Active |
| Secret Detection | âœ… Active |
| Dependency Scan | âœ… Active |
| CodeQL Analysis | âœ… Active |

---

## âœ¨ Special Features

*Beyond the core security modules, RentVerse includes these unique features that enhance the rental experience.*

### ğŸ“ Digital Rental Agreements

Complete digital agreement workflow with legally-binding electronic signatures.

| Feature | Description |
|---------|-------------|
| ğŸ” E-Signatures | Canvas-based signature capture with SHA-256 hashing |
| ğŸ“„ PDF Generation | Automated lease contract generation with Puppeteer |
| âœ… Dual-Party Signing | Landlord signs first, then tenant counter-signs |
| ğŸ“Š Audit Trail | Complete history of all agreement actions |
| ğŸ” Document Integrity | Hash verification ensures no tampering |
| â˜ï¸ Cloud Storage | PDFs stored securely on Cloudinary |

**Signing Workflow:**
```
1. Landlord creates lease â†’ PDF generated
2. Landlord signs â†’ Signature hash stored
3. Tenant notified â†’ Signs agreement
4. Both signatures â†’ Agreement activated
5. Both parties receive final PDF
```

**Key Files:**
- `digitalAgreement.service.js` - Workflow & signature validation
- `pdfGeneration.service.js` - Puppeteer PDF generation
- `eSignature.service.js` - Canvas signature handling
- `agreement.routes.js` - Agreement API endpoints

---

### ğŸ” OTP-Based Password Reset

Secure forgot password flow with email OTP verification.

**Security Features:**
- âœ… Rate-limited requests (3/minute)
- âœ… OTP expires in 5 minutes
- âœ… Reset token expires in 5 minutes
- âœ… Password strength requirements enforced
- âœ… Confirmation email on password change
- âœ… Generic responses prevent email enumeration

**Flow:**
```
1. User enters email â†’ OTP sent
2. User enters OTP â†’ Verified
3. User sets new password â†’ Updated
4. Confirmation email sent
```

**Key Files:**
- `auth.js` - `/forgot-password/*` endpoints
- `email.service.js` - Password reset email templates
- `app/auth/forgot-password/page.tsx` - Frontend UI

---

### ğŸ“§ Smart Email Notification System

Beautiful, responsive email templates for all platform events.

**Email Types:**

| Email | Trigger |
|-------|---------|
| ğŸ” Login OTP | MFA verification during login |
| ğŸ”‘ Password Reset OTP | Forgot password request |
| âœ… Password Changed | After password update |
| ğŸ›¡ï¸ MFA Enabled | When user enables 2FA |
| âš ï¸ Security Alert | Suspicious activity detected |
| ğŸ“ Agreement Ready | When lease is ready to sign |
| âœ… Agreement Signed | Confirmation of signatures |

**Features:**
- ğŸ“± Mobile-responsive HTML templates
- ğŸ¨ Branded with RentVerse colors
- ğŸ“§ Works with Gmail, Outlook, Apple Mail
- ğŸ”„ Fallback plain text for all emails

---

### ğŸ‘‘ Admin Dashboard

Comprehensive administration panel for platform management.

| Module | Capabilities |
|--------|--------------|
| ğŸ‘¥ User Management | View, suspend, delete users |
| ğŸ  Property Moderation | Approve, reject, feature listings |
| ğŸ“ Agreement Oversight | View all agreements, download PDFs |
| ğŸ”’ Security Logs | View login attempts, security events |

**Access Control:**
- Only users with `role: ADMIN` can access
- Protected API routes with role middleware
- Audit logging for all admin actions

**Key Files:**
- `admin.users.routes.js` - User management
- `admin.properties.routes.js` - Property moderation
- `admin.agreements.routes.js` - Agreement oversight
- `admin.security.routes.js` - Security logs
- `app/admin/*` - Admin frontend pages

---

### ğŸ“± Mobile Application

Native Android app built with Capacitor for on-the-go access.

**Features:**
- ğŸ”— Deep linking to properties
- ğŸ”” Push notification ready
- ğŸ“· Property photo viewing
- ğŸ” Full authentication support
- ğŸ“ View and manage agreements

**Download:** [RentVerse APK](MobileAppBuild/rentverse-vecna.apk)

**Key Files:**
- `MobileAppIntegration/` - Mobile configuration docs
- `capacitor.config.ts` - Capacitor configuration
- `android/` - Android native project

---

### ğŸ“… Booking & Viewing System

Schedule property viewings with landlords.

**Features:**
- Select available time slots
- Request property viewings
- Landlord approval workflow
- Email notifications for both parties

**Key Files:**
- `modules/bookings/` - Booking backend
- `app/property/[id]/booking/` - Booking UI

---

## ğŸ› ï¸ Technology Stack

<div align="center">

### ğŸ–¥ï¸ Backend Technologies

<table>
  <tr>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/nodejs/nodejs-icon.svg" width="48" height="48"><br>
      <b>Node.js</b><br>
      <sub>v20+ Runtime</sub>
    </td>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/expressjs/expressjs-icon.svg" width="48" height="48"><br>
      <b>Express.js</b><br>
      <sub>v4.18 Framework</sub>
    </td>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/postgresql/postgresql-icon.svg" width="48" height="48"><br>
      <b>PostgreSQL</b><br>
      <sub>Database</sub>
    </td>
    <td align="center" width="100">
      <img src="https://avatars.githubusercontent.com/u/17219288" width="48" height="48"><br>
      <b>Prisma</b><br>
      <sub>v5.3 ORM</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/jsonwebtokens" width="48" height="48"><br>
      <b>JWT</b><br>
      <sub>Authentication</sub>
    </td>
  </tr>
  <tr>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/passport" width="48" height="48"><br>
      <b>Passport.js</b><br>
      <sub>v0.7 OAuth</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/puppeteer" width="48" height="48"><br>
      <b>Puppeteer</b><br>
      <sub>v24 PDF Gen</sub>
    </td>
    <td align="center" width="100">
      <img src="https://raw.githubusercontent.com/nodemailer/nodemailer/master/assets/nm_logo_200x136.png" width="48" height="48"><br>
      <b>Nodemailer</b><br>
      <sub>v7 Email</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/swagger" width="48" height="48"><br>
      <b>Swagger</b><br>
      <sub>API Docs</sub>
    </td>
    <td align="center" width="100">
      <img src="https://avatars.githubusercontent.com/u/25641704" width="48" height="48"><br>
      <b>Helmet.js</b><br>
      <sub>v7 Security</sub>
    </td>
  </tr>
</table>

### ğŸ¨ Frontend Technologies

<table>
  <tr>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/nextjs/nextjs-icon.svg" width="48" height="48"><br>
      <b>Next.js</b><br>
      <sub>v16 Framework</sub>
    </td>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/reactjs/reactjs-icon.svg" width="48" height="48"><br>
      <b>React</b><br>
      <sub>v19.1 Library</sub>
    </td>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/typescriptlang/typescriptlang-icon.svg" width="48" height="48"><br>
      <b>TypeScript</b><br>
      <sub>v5 Language</sub>
    </td>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/tailwindcss/tailwindcss-icon.svg" width="48" height="48"><br>
      <b>Tailwind CSS</b><br>
      <sub>v4 Styling</sub>
    </td>
    <td align="center" width="100">
      <img src="https://raw.githubusercontent.com/pmndrs/zustand/main/docs/favicon.ico" width="48" height="48"><br>
      <b>Zustand</b><br>
      <sub>v5 State</sub>
    </td>
  </tr>
  <tr>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/maptiler" width="48" height="48"><br>
      <b>MapTiler</b><br>
      <sub>v3.8 Maps</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/swiper" width="48" height="48"><br>
      <b>Swiper</b><br>
      <sub>v12 Carousel</sub>
    </td>
    <td align="center" width="100">
      <img src="https://lucide.dev/logo.light.svg" width="48" height="48"><br>
      <b>Lucide</b><br>
      <sub>Icons</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/eslint" width="48" height="48"><br>
      <b>ESLint</b><br>
      <sub>v9 Linting</sub>
    </td>
    <td align="center" width="100">
      <img src="https://turbo.build/images/docs/pack/turbopack-hero-logo-dark.svg" width="48" height="48"><br>
      <b>Turbopack</b><br>
      <sub>Bundler</sub>
    </td>
  </tr>
</table>

### ğŸ“± Mobile Technologies

<table>
  <tr>
    <td align="center" width="120">
      <img src="https://user-images.githubusercontent.com/236501/85893648-1c92e880-b7a8-11ea-926d-95355b8175c7.png" width="48" height="48"><br>
      <b>Capacitor</b><br>
      <sub>v8 Framework</sub>
    </td>
    <td align="center" width="120">
      <img src="https://www.vectorlogo.zone/logos/android/android-icon.svg" width="48" height="48"><br>
      <b>Android</b><br>
      <sub>Native APK</sub>
    </td>
    <td align="center" width="120">
      <img src="https://cdn.simpleicons.org/deepnote" width="48" height="48"><br>
      <b>Deep Linking</b><br>
      <sub>URL Scheme</sub>
    </td>
    <td align="center" width="120">
      <img src="https://cdn.simpleicons.org/webauthn" width="48" height="48"><br>
      <b>Status Bar</b><br>
      <sub>Native Plugin</sub>
    </td>
  </tr>
</table>

### â˜ï¸ Cloud Services

<table>
  <tr>
    <td align="center" width="100">
      <img src="https://assets.vercel.com/image/upload/v1588805858/repositories/vercel/logo.png" width="48" height="48"><br>
      <b>Vercel</b><br>
      <sub>Frontend Host</sub>
    </td>
    <td align="center" width="100">
      <img src="https://images.g2crowd.com/uploads/product/image/large_detail/large_detail_477db83f729d63210139ec7cd29c1351/render-render.png" width="48" height="48"><br>
      <b>Render</b><br>
      <sub>Backend Host</sub>
    </td>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/supabase/supabase-icon.svg" width="48" height="48"><br>
      <b>Supabase</b><br>
      <sub>PostgreSQL DB</sub>
    </td>
    <td align="center" width="100">
      <img src="https://avatars.githubusercontent.com/u/1460763" width="48" height="48"><br>
      <b>Cloudinary</b><br>
      <sub>Media CDN</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/resend" width="48" height="48"><br>
      <b>Resend</b><br>
      <sub>Email API</sub>
    </td>
  </tr>
</table>

### ğŸ” Security & Authentication

<table>
  <tr>
    <td align="center" width="140">
      <img src="https://www.vectorlogo.zone/logos/google/google-icon.svg" width="48" height="48"><br>
      <b>Google OAuth</b><br>
      <sub>Social Login</sub>
    </td>
    <td align="center" width="140">
      <img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width="48" height="48"><br>
      <b>HTTPS/TLS</b><br>
      <sub>Encryption</sub>
    </td>
  </tr>
</table>

### ğŸ¤– AI & Automation

<table>
  <tr>
    <td align="center" width="140">
      <img src="https://cdn.simpleicons.org/openai" width="48" height="48"><br>
      <b>RevAI</b><br>
      <sub>Property Auto-Review</sub>
    </td>
    <td align="center" width="140">
      <img src="https://api.iconify.design/mdi/qrcode.svg" width="48" height="48"><br>
      <b>QR Code</b><br>
      <sub>v1.5 Generator</sub>
    </td>
    <td align="center" width="140">
      <img src="https://www.vectorlogo.zone/logos/adobe_acrobat/adobe_acrobat-icon.svg" width="48" height="48"><br>
      <b>PDF Generation</b><br>
      <sub>Digital Agreements</sub>
    </td>
  </tr>
</table>

### ğŸ”„ DevSecOps & CI/CD

<table>
  <tr>
    <td align="center" width="100">
      <img src="https://www.vectorlogo.zone/logos/github/github-icon.svg" width="48" height="48"><br>
      <b>GitHub Actions</b><br>
      <sub>CI/CD Pipeline</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/eslint" width="48" height="48"><br>
      <b>ESLint</b><br>
      <sub>SAST Linting</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/githubactions" width="48" height="48"><br>
      <b>CodeQL</b><br>
      <sub>Security Analysis</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/git" width="48" height="48"><br>
      <b>Gitleaks</b><br>
      <sub>Secret Detection</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/aqua" width="48" height="48"><br>
      <b>Trivy</b><br>
      <sub>Vulnerability Scan</sub>
    </td>
  </tr>
  <tr>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/prettier" width="48" height="48"><br>
      <b>Prettier</b><br>
      <sub>Code Formatting</sub>
    </td>
    <td align="center" width="100">
      <img src="https://avatars.githubusercontent.com/u/35137722" width="48" height="48"><br>
      <b>Husky</b><br>
      <sub>Git Hooks</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/pnpm" width="48" height="48"><br>
      <b>pnpm</b><br>
      <sub>v10 Package Mgr</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/nodemon" width="48" height="48"><br>
      <b>Nodemon</b><br>
      <sub>Dev Server</sub>
    </td>
    <td align="center" width="100">
      <img src="https://cdn.simpleicons.org/typescript" width="48" height="48"><br>
      <b>TypeScript</b><br>
      <sub>Type Checking</sub>
    </td>
  </tr>
</table>

</div>

---

## ğŸ“š API Documentation

Interactive API documentation available at:

| Resource | Endpoint |
|----------|----------|
| **Swagger UI** | `/docs` endpoint on the backend |

---

## âš–ï¸ Intellectual Property & Ownership

### Proprietary Rights

In compliance with the project engagement agreement, all deliverables, including source code, algorithms, designs, and documentation ("Work Product") produced within this repository are the exclusive property of **Metairflow R&D Sdn. Bhd.**

### Usage Restrictions

- This repository is submitted as part of the **Mobile SecOps 21 Days Challenge**.
- Unauthorized reproduction, development of derivative solutions, or commercial use of this Work Product is strictly prohibited for **24 months** following the engagement without written consent from Metairflow R&D Sdn. Bhd.

### Confidentiality

This repository adheres to the **Non-Disclosure Agreement (NDA)**. No internal trade secrets or proprietary algorithms of the Disclosing Party have been exposed in this public documentation. Obligations regarding Confidential Information remain effective for **three (3) years** after engagement ends.

### Licensing Compliance

All third-party libraries and open-source components used in this project are compliant with their respective licenses (MIT, Apache 2.0) and documented for commercial compatibility.

---

<div align="center">
  <p><i>Built with â¤ï¸ by Team Vecna for Mobile SecOps Challenge 2025</i></p>
  <p><i>Governed by the laws of Malaysia (Copyright Act 1987)</i></p>
</div>